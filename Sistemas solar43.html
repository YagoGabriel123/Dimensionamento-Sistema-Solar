<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dimensionamento Solar RN</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #2e86de;
            text-align: center;
        }

        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: 20px auto;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background-color: #2e86de;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 4px;
        }

        button:hover {
            background-color: #1b4d8c;
        }

        .result {
            background-color: #eaf2f8;
            padding: 15px;
            border: 1px solid #d4e6f1;
            margin-top: 20px;
        }

        .error {
            color: red;
        }

        /* Estilos para a calculadora padrão */
        .calc {
            margin-top: 40px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            padding: 10px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .calc button {
            width: 60px;
            margin: 5px;
        }

        #inputCalc {
            width: calc(100% - 20px);
            padding: 10px;
            margin: 10px 0;
        }

        #btnSalvarPDF {
            margin-top: 20px;
            display: block;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>Dimensionamento de Sistema Solar - RN</h1>

    <form id="solarForm">
        <label for="nomeCliente">Nome do Cliente:</label>
        <input type="text" id="nomeCliente" required>

        <label for="contato">Contato:</label>
        <input type="text" id="contato" required>

        <label for="endereco">Endereço:</label>
        <input type="text" id="endereco" required>

        <label for="tipoLigacao">Tipo de Ligação:</label>
        <select id="tipoLigacao" required>
            <option value="monofasica">Monofásica</option>
            <option value="trifasica">Trifásica</option>
        </select>

        <label for="consumoMensal">Consumo Médio Mensal (kWh):</label>
        <input type="number" id="consumoMensal" placeholder="Digite o consumo em kWh" min="1" required>

        <label for="potenciaPainel">Selecione a Potência do Painel:</label>
        <select id="potenciaPainel" required>
            <option value="610">DAH - 610W</option>
            <option value="555">ZNShine Solar - 555W</option>
            <option value="570">PULLING - 570W</option>
        </select>

        <button type="button" onclick="calcularSistema()">Calcular Sistema</button>

        <div id="resultado" class="result"></div>
        <button id="btnSalvarPDF" type="button" style="display:none;" onclick="salvarPDF()">Salvar em PDF</button>
    </form>

    <div class="calc">
        <h2>Calculadora Padrão</h2>
        <input type="text" id="inputCalc" placeholder="0" readonly>
        <div>
            <button onclick="adicionarNumero('1')">1</button>
            <button onclick="adicionarNumero('2')">2</button>
            <button onclick="adicionarNumero('3')">3</button>
            <button onclick="realizarOperacao('+')">+</button>
        </div>
        <div>
            <button onclick="adicionarNumero('4')">4</button>
            <button onclick="adicionarNumero('5')">5</button>
            <button onclick="adicionarNumero('6')">6</button>
            <button onclick="realizarOperacao('-')">-</button>
        </div>
        <div>
            <button onclick="adicionarNumero('7')">7</button>
            <button onclick="adicionarNumero('8')">8</button>
            <button onclick="adicionarNumero('9')">9</button>
            <button onclick="realizarOperacao('*')">*</button>
        </div>
        <div>
            <button onclick="limpar()">C</button>
            <button onclick="adicionarNumero('0')">0</button>
            <button onclick="calcularResultado()">=</button>
            <button onclick="realizarOperacao('/')">/</button>
        </div>
        <div id="resultadoCalc"></div>
    </div>

    <script>
        function calcularSistema() {
            const nomeCliente = document.getElementById('nomeCliente').value;
            const contato = document.getElementById('contato').value;
            const endereco = document.getElementById('endereco').value;
            const tipoLigacao = document.getElementById('tipoLigacao').value;
            const consumoMensal = parseFloat(document.getElementById('consumoMensal').value);
            const potenciaPainel = document.getElementById('potenciaPainel').value;

            // Especificações dos painéis
            let marcaPainel, potenciaNominal, correnteMaximaPainel, correnteCurtoCircuito, tensaoPainel, tensaoCircuitoAberto;

            if (potenciaPainel === "610") {
                marcaPainel = "DAH";
                potenciaNominal = 610;
                correnteMaximaPainel = 13.68;
                correnteCurtoCircuito = 14.72;
                tensaoPainel = 52.4;
                tensaoCircuitoAberto = 52.4;
            } else if (potenciaPainel === "555") {
                marcaPainel = "ZNShine Solar";
                potenciaNominal = 555;
                correnteMaximaPainel = 14.5;
                correnteCurtoCircuito = 15.35;
                tensaoPainel = 46.2;
                tensaoCircuitoAberto = 46.2;
            } else if (potenciaPainel === "570") {
                marcaPainel = "PULLING";
                potenciaNominal = 570;
                correnteMaximaPainel = 14.28;
                correnteCurtoCircuito = 15.12;
                tensaoPainel = 47.82;
                tensaoCircuitoAberto = 47.82;
            }

            // Validação dos dados
            if (consumoMensal <= 0) {
                document.getElementById('resultado').innerHTML = '<p class="error">Por favor, insira valores válidos.</p>';
                return;
            }

            // HSP Médio em Natal (5.67)
            const hsp = 5.67;
            const diasPorMes = 30;
            const eficiencia = 0.80; // Perdas de 20%

            // Cálculo da energia necessária por dia
            const consumoDiario = consumoMensal / diasPorMes;

            // Cálculo da energia gerada por painel por dia
            const energiaPorPainel = (potenciaNominal * hsp * eficiencia) / 1000; // kWh/dia
            const numPaineis = Math.ceil(consumoDiario / energiaPorPainel);

            // Potência total do sistema (em watts)
            const potenciaTotalSistema = numPaineis * potenciaNominal;

            // Definindo a potência ideal do inversor
            const potenciaInversorIdeal = Math.ceil(potenciaTotalSistema / 1000);

            // Verificação de limites de tensão e corrente do inversor com base no tipo de ligação
            let minTensao, maxTensao, maxCorrente, mensagem, numStrings = 1;
            if (tipoLigacao === 'trifasica') {
                minTensao = 180;
                maxTensao = 850;
                maxCorrente = 18.75;
                numStrings = 3; // Exemplo para trifásico
            } else {
                minTensao = 90;
                maxTensao = 450;
                maxCorrente = 40.00;
                numStrings = 1; // Exemplo para monofásico
            }

            if (potenciaTotalSistema / 1000 > maxCorrente) {
                mensagem = "A corrente total do sistema excede o máximo permitido.";
            } else if (numPaineis > 12) { // Apenas para monofásico
                mensagem = "O número de painéis excede o máximo recomendado para um inversor monofásico.";
            } else {
                mensagem = "Sistema dimensionado corretamente para uma ligação " + tipoLigacao + ".";
            }

            // Cálculo de tensões e distribuição dos painéis
            let tensaoString1 = tensaoCircuitoAberto * 10; // 10 painéis na string 1
            let tensaoString2 = tensaoCircuitoAberto * 3;  // 3 painéis na string 2

            // Cálculo de potência do inversor
            const potenciaInversores = {
                ideal: potenciaInversorIdeal,
                overload10: Math.floor(potenciaInversorIdeal * 0.9),
                overload20: Math.floor(potenciaInversorIdeal * 0.8),
                overload30: Math.floor(potenciaInversorIdeal * 0.7),
                overload40: Math.floor(potenciaInversorIdeal * 0.6),
                overload50: Math.floor(potenciaInversorIdeal * 0.5),
            };

            // Exibição do resultado
            document.getElementById('resultado').innerHTML = `
                <strong>Resultados:</strong><br>
                Nome do Cliente: ${nomeCliente}<br>
                Contato: ${contato}<br>
                Endereço: ${endereco}<br>
                Consumo Médio Mensal (kWh): ${consumoMensal}<br>
                Quantidade de painéis necessários: ${numPaineis}<br>
                Potência total do sistema: ${(potenciaTotalSistema / 1000).toFixed(2)} kW<br>
                Potência Ideal do Inversor (0% overload): ${potenciaInversorIdeal} kW<br>
                Sugestões de Inversores:<br>
                Inversor Ideal (0% overload): ${potenciaInversores.ideal} kW<br>
                Inversor com Overload 10.0%: ${potenciaInversores.overload10} kW<br>
                Inversor com Overload 20.0%: ${potenciaInversores.overload20} kW<br>
                Inversor com Overload 30.0%: ${potenciaInversores.overload30} kW<br>
                Inversor com Overload 40.0%: ${potenciaInversores.overload40} kW<br>
                Inversor com Overload 50.0%: ${potenciaInversores.overload50} kW<br>
                Detalhes do Painel Selecionado:<br>
                Marca: ${marcaPainel}<br>
                Potência Nominal: ${potenciaNominal} W<br>
                Corrente Máxima: ${correnteMaximaPainel} A<br>
                Corrente de Curto Circuito: ${correnteCurtoCircuito} A<br>
                Tensão de Circuito Aberto (máxima): ${tensaoCircuitoAberto} V<br>
                Distribuição dos painéis por string e tensão total:<br>
                String 1: 10 painéis (${tensaoString1.toFixed(2)} V)<br>
                String 2: 3 painéis (${tensaoString2.toFixed(2)} V)<br>
                <strong>${mensagem}</strong>
            `;
            document.getElementById('btnSalvarPDF').style.display = 'block';
        }

        function salvarPDF() {
            const resultado = document.getElementById('resultado').innerHTML;
            const blob = new Blob([resultado], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'resultado_dimensionamento_solar.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Calculadora Padrão
        let calculoAtual = '';
        function adicionarNumero(numero) {
            calculoAtual += numero;
            document.getElementById('inputCalc').value = calculoAtual;
        }

        function realizarOperacao(operacao) {
            calculoAtual += ` ${operacao} `;
            document.getElementById('inputCalc').value = calculoAtual;
        }

        function calcularResultado() {
            try {
                const resultado = eval(calculoAtual);
                document.getElementById('resultadoCalc').innerText = resultado;
                calculoAtual = '';
                document.getElementById('inputCalc').value = '';
            } catch (error) {
                document.getElementById('resultadoCalc').innerText = 'Erro';
            }
        }

        function limpar() {
            calculoAtual = '';
            document.getElementById('inputCalc').value = '';
            document.getElementById('resultadoCalc').innerText = '';
        }
    </script>
</body>
</html>
